<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Zenith Playground</title>

<style>
/* =====================
   UI STYLE (NOT OUTPUT)
===================== */
body {
  background:#0b0f14;
  color:#c9d1d9;
  font-family: "Fira Code", monospace;
  padding:24px;
}

h1 {
  color:#58a6ff;
  margin-bottom:8px;
}

h2 {
  color:#7ee787;
  margin-top:24px;
}

textarea {
  width:100%;
  height:220px;
  background:#010409;
  color:#c9d1d9;
  border:1px solid #30363d;
  border-radius:8px;
  padding:12px;
  font-size:14px;
}

pre {
  background:#010409;
  border:1px solid #30363d;
  border-radius:8px;
  padding:12px;
  min-height:140px;
  white-space:pre-wrap;
}

button {
  background:#238636;
  color:white;
  border:none;
  padding:10px 18px;
  border-radius:999px;
  font-weight:600;
  cursor:pointer;
}

button:hover {
  background:#2ea043;
}

.controls {
  margin:12px 0;
  display:flex;
  gap:12px;
}

#preview {
  display:none;
  position:fixed;
  inset:0;
  background:#000c;
  z-index:999;
}

#preview iframe {
  width:90%;
  height:90%;
  margin:3% auto;
  display:block;
  background:white;
  border-radius:12px;
}

#preview button {
  position:absolute;
  top:16px;
  right:16px;
  background:#f85149;
}
</style>
</head>

<body>

<h1>Zenith Simple Code</h1>

<textarea id="zenInput">
/zen
/lang "en"

/head
/charset
/page "Zenith Demo"
/head/

/header
/title "Hello World" serif:bold:#ccc:center
/header/
</textarea>

<div class="controls">
  <button onclick="compileZenith()">Compile</button>
  <button onclick="previewZenith()">Preview</button>
</div>

<h2>HTML Output</h2>
<pre id="htmlOut"></pre>

<h2>CSS Output</h2>
<pre id="cssOut"></pre>

<div id="preview">
  <button onclick="closePreview()">Close</button>
  <iframe id="frame"></iframe>
</div>

<script>
/* =====================
   DICTIONARY
===================== */
const DICTIONARY = {
  zen: { type: "doctype" },
  lang: { type: "lang" },
  head: { type: "block", tag: "head" },
  charset: { type: "meta", output: '<meta charset="UTF-8">' },
  page: { type: "title" },
  header: { type: "block", tag: "header" },
  title: { type: "text", tag: "h1" }
};

/* =====================
   GRAMMAR RULES
===================== *
- Lines start with /
- Blocks open with /name
- Blocks close with /name/
- Text values use quotes
- Styles after text: font:weight:color:align
- centre â†’ center auto fixed
*/

/* =====================
   COMPILER
===================== */
function compileZenith() {
  const input = zenInput.value.split("\n");

  let lang = "en";
  let pageTitle = "Zenith Page";
  let body = [];
  let css = [];
  let openBlocks = [];

  let classId = 0;

  for (let raw of input) {
    const line = raw.trim();
    if (!line) continue;

    // /zen
    if (line === "/zen") continue;

    // /lang "en"
    if (line.startsWith("/lang")) {
      lang = line.match(/"(.+?)"/)?.[1] || lang;
      continue;
    }

    // /head and /head/
    if (line === "/head") continue;
    if (line === "/head/") continue;

    // /charset
    if (line === "/charset") continue;

    // /page "Title"
    if (line.startsWith("/page")) {
      pageTitle = line.match(/"(.+?)"/)?.[1] || pageTitle;
      continue;
    }

    // /header
    if (line === "/header") {
      body.push("<header>");
      openBlocks.push("header");
      continue;
    }

    // /header/
    if (line === "/header/") {
      body.push("</header>");
      openBlocks.pop();
      continue;
    }

    // /title "text" styles
    if (line.startsWith("/title")) {
      const match = line.match(/"(.+?)"\s*(.*)/);
      const text = match?.[1] || "";
      const style = match?.[2] || "";

      const className = `z-${++classId}`;
      body.push(`<h1 class="${className}">${text}</h1>`);

      if (style) {
        const p = style.split(":");
        let rules = [];

        if (p[0]) rules.push(`font-family:${p[0]}`);
        if (p[1]) rules.push(`font-weight:${p[1]}`);
        if (p[2]) rules.push(`color:${p[2]}`);
        if (p[3]) rules.push(`text-align:${p[3] === "centre" ? "center" : p[3]}`);

        css.push(`.${className} { ${rules.join("; ")}; }`);
      }

      continue;
    }
  }

  const html =
`<!DOCTYPE html>
<html lang="${lang}">
<head>
<meta charset="UTF-8">
<title>${pageTitle}</title>
</head>
<body>
${body.join("\n")}
</body>
</html>`;

  htmlOut.textContent = html;
  cssOut.textContent = css.length ? css.join("\n") : "/* no styles */";
}

/* =====================
   PREVIEW
===================== */
function previewZenith() {
  if (!htmlOut.textContent) compileZenith();

  const html = htmlOut.textContent;
  const css = cssOut.textContent;

  const bodyOnly = html.split("<body>")[1].split("</body>")[0];

  frame.srcdoc = `
<!DOCTYPE html>
<html>
<head>
<style>${css}</style>
</head>
<body>
${bodyOnly}
</body>
</html>`;

  preview.style.display = "block";
}

function closePreview() {
  preview.style.display = "none";
}
</script>

</body>
</html>