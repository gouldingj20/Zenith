<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Zenith Simple Code</title>
<style>
body { font-family: sans-serif; padding: 40px; background: #fdfdfd; }
textarea { width:100%; height:30vh; font-family: monospace; font-size:16px; padding:12px; border-radius:8px; border:1px solid #ccc; margin-bottom:20px; box-sizing:border-box; }
pre { width:100%; height:25vh; background:#f5f5f5; border:1px solid #ccc; border-radius:8px; padding:12px; box-sizing:border-box; overflow:auto; white-space:pre-wrap; font-family: monospace; font-size:16px; }
#divider { text-align:center; font-weight:bold; margin:10px 0; }
#warnings { color:red; font-family: monospace; margin-top:10px; }
h1 { margin-bottom:20px; }
</style>
</head>
<body>

<h1>Zenith Simple Code</h1>

<textarea id="zenithInput" placeholder="Type your Zenith code here..."></textarea>

<pre id="htmlOutput"></pre>

<div id="divider">----- CSS -----</div>

<pre id="cssOutput"></pre>

<div id="warnings"></div>

<script>
// --- Dictionary ---
const dictionary = {
  "zenith": {type:"meta"},
  "page": {type:"meta"},
  "header": {tag:"header", type:"section"},
  "hero": {tag:"section", type:"section"},
  "main": {tag:"main", type:"section"},
  "footer": {tag:"footer", type:"section"},
  "stack": {tag:"div", type:"layout", style:"display:flex;flex-direction:column;gap:40px"},
  "grid": {tag:"div", type:"layout", style:"display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:32px"},
  "column": {tag:"div", type:"layout", style:"display:flex;flex-direction:column;gap:16px"},
  "actions": {tag:"div", type:"layout", style:"display:flex;gap:16px;flex-wrap:wrap"},
  "title": {tag:"h1", type:"text"},
  "subtitle": {tag:"h2", type:"text"},
  "text": {tag:"p", type:"text"},
  "step": {tag:"p", type:"text", style:"font-weight:500"},
  "button": {tag:"button", type:"interactive", style:"padding:14px 28px;border-radius:999px;border:none;cursor:pointer"},
  "link": {tag:"a", type:"interactive"},
  "image": {tag:"img", type:"media"},
  "card": {tag:"div", type:"component", style:"padding:32px;border-radius:16px;background:white;box-shadow:0 20px 40px rgba(0,0,0,0.06)"},
  "section": {tag:"section", type:"section"}
};

// --- Compiler ---
function compileZenith(code){
  const lines = code.split("\n");
  let htmlLines = [];
  let cssLines = [];
  let warnings = [];
  let generatedClasses = new Set();
  let htmlLang = "en";      // default lang
  let pageTitle = "Zenith Page";

  function parse(i=0, parentIndent=0){
    let result = [];
    while(i<lines.length){
      let line = lines[i];
      if(!line.trim()){ i++; continue; }
      let indent = line.match(/^(\s*)/)[1].length;
      if(indent<parentIndent) break;

      line = line.trim();
      if(line.startsWith("/")){
        const [el,...rest] = line.split(" ");
        const name = el.slice(1);
        let content = rest.join(" ").replace(/^["“”]|["“”]$/g,'');
        const def = dictionary[name];

        if(!def){
          warnings.push(`Line ${i+1}: Unknown element '${name}'`);
          result.push(`<!-- Unknown element: ${name} -->`);
          i++; continue;
        }

        if(def.type==="meta"){
          if(name==="zenith"){
            // Check if version includes lang at the end
            const langMatch = rest.find(r => /^[a-z]{2}$/i.test(r));
            if(langMatch) htmlLang = langMatch.toLowerCase();
          } else if(name==="page"){
            pageTitle = content || "Zenith Page";
          }
          i++; continue;
        }

        const tag = def.tag || "div";
        const classAttr = (def.type==="layout"||def.type==="component")?` class="${name}"`:"";
        let children = "";

        if(def.type==="layout"||def.type==="section"||def.type==="component"){
          const childResult = parse(i+1, indent+1);
          children = childResult.lines.join("\n");
          i = childResult.next-1;
        }

        if(tag==="img") result.push(`<img src="${content}" alt="" />`);
        else result.push(`<${tag}${classAttr}>${content}${children?'\n'+children+'\n':''}</${tag}>`);

        if(def.style && !generatedClasses.has(name)){
          if(classAttr) cssLines.push(`.${name} { ${def.style} }`);
          else cssLines.push(`${tag} { ${def.style} }`);
          generatedClasses.add(name);
        }

      } else {
        result.push(`<p>${line}</p>`);
      }
      i++;
    }
    return {lines: result, next: i};
  }

  let bodyResult = parse(0);

  // Build final HTML properly
  htmlLines.push('<!DOCTYPE html>');
  htmlLines.push('<html lang="'+htmlLang+'">');
  htmlLines.push('<head>');
  htmlLines.push('  <meta charset="UTF-8">');
  htmlLines.push('  <title>'+pageTitle+'</title>');
  htmlLines.push('</head>');
  htmlLines.push('<body>');
  htmlLines.push(...bodyResult.lines);
  htmlLines.push('</body>');
  htmlLines.push('</html>');

  return {html: htmlLines.join("\n"), css: cssLines.join("\n"), warnings};
}

// --- DOM ---
window.addEventListener("DOMContentLoaded",()=>{
  const input=document.getElementById("zenithInput");
  const htmlOut=document.getElementById("htmlOutput");
  const cssOut=document.getElementById("cssOutput");
  const warningsDiv=document.getElementById("warnings");

  input.addEventListener("input",()=>{
    const {html, css, warnings} = compileZenith(input.value);
    htmlOut.textContent = html;
    cssOut.textContent = css;
    warningsDiv.textContent = warnings.length ? warnings.join("\n") : "";
  });
});
</script>

</body>
</html>