<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Zenith Playground</title>

<style>
/* =====================
   UI STYLE (NOT OUTPUT)
===================== */
body {
  background:#0b0f14;
  color:#c9d1d9;
  font-family: "Fira Code", monospace;
  padding:24px;
}

h1 {
  color:#58a6ff;
  margin-bottom:8px;
}

h2 {
  color:#7ee787;
  margin-top:24px;
}

textarea {
  width:100%;
  height:220px;
  background:#010409;
  color:#c9d1d9;
  border:1px solid #30363d;
  border-radius:8px;
  padding:12px;
  font-size:14px;
}

pre {
  background:#010409;
  border:1px solid #30363d;
  border-radius:8px;
  padding:12px;
  min-height:140px;
  white-space:pre-wrap;
}

button {
  background:#238636;
  color:white;
  border:none;
  padding:10px 18px;
  border-radius:999px;
  font-weight:600;
  cursor:pointer;
}

button:hover {
  background:#2ea043;
}

.controls {
  margin:12px 0;
  display:flex;
  gap:12px;
}

#preview {
  display:none;
  position:fixed;
  inset:0;
  background:#000c;
  z-index:999;
}

#preview iframe {
  width:90%;
  height:90%;
  margin:3% auto;
  display:block;
  background:white;
  border-radius:12px;
}

#preview button {
  position:absolute;
  top:16px;
  right:16px;
  background:#f85149;
}
</style>
</head>

<body>

<h1>Zenith Simple Code</h1>

<textarea id="zenInput">
/zen
/lang "en"

/head
/charset
/page "Zenith Demo"
/head/

/header
/title "Hello World" serif:bold:#ccc:center
/header/
</textarea>

<div class="controls">
  <button onclick="compileZenith()">Compile</button>
  <button onclick="previewZenith()">Preview</button>
</div>

<h2>HTML Output</h2>
<pre id="htmlOut"></pre>

<h2>CSS Output</h2>
<pre id="cssOut"></pre>

<div id="preview">
  <button onclick="closePreview()">Close</button>
  <iframe id="frame"></iframe>
</div>

<script>
/* ============================
   DOM BINDINGS
=============================== */
const zenInput = document.getElementById("zenInput");
const htmlOut  = document.getElementById("htmlOut");
const cssOut   = document.getElementById("cssOut");
const frame    = document.getElementById("frame");

/* ============================
   ZENITH V1 — GRAMMAR
===============================

Rules:

1. Line structure:
   - All commands start with /
   - Example: /tagName "text" key:value key2:"complex value"

2. Blocks:
   - /tag opens a block
   - /tag/ closes a block
   - Example:
     /header
     /title "Hello World"
     /header/

3. Self-closing tags:
   - Defined in dictionary as type:"self"
   - Do not need a closing /tag/

4. Text:
   - Must be wrapped in quotes: "Some text here"
   - Only one text node per line is allowed

5. Attributes:
   - key:value or key:"value"
   - Boolean attributes are allowed (no value needed)

6. Style shortcuts (Zenith-specific):
   - font:font-family
   - weight:font-weight
   - color:text color
   - align:text-align
   - size:font-size (pixels)
   - gap:gap (for grid/flex)
   - cols:number of grid columns
   - These are automatically converted into CSS classes

7. Special directives:
   - /zen → Doctype
   - /lang "en" → Language for <html>
   - /charset → <meta charset="UTF-8">
   - /page "Title" → Sets <title>

8. Zen-only blocks:
   - /grid → grid container
   - /card → card container

Notes:
- Nesting must be proper: open /tag, then close /tag/
- Any unknown tag is ignored
- /title outside /head → automatically becomes <h1>
- All CSS is separated from HTML and generated into classes

===============================
*/



/* ============================
   ZENITH V1 — DICTIONARY
=============================== */
const DICTIONARY = {
  zen: { type: "doctype" },

  html: { type: "block", tag: "html" },
  head: { type: "block", tag: "head" },
  body: { type: "block", tag: "body" },
  title: { type: "block", tag: "title" },
  meta: { type: "self", tag: "meta" },

  header: { type: "block", tag: "header" },
  nav: { type: "block", tag: "nav" },
  main: { type: "block", tag: "main" },
  section: { type: "block", tag: "section" },
  article: { type: "block", tag: "article" },
  aside: { type: "block", tag: "aside" },
  footer: { type: "block", tag: "footer" },

  h1: { type: "block", tag: "h1" },
  h2: { type: "block", tag: "h2" },
  h3: { type: "block", tag: "h3" },
  h4: { type: "block", tag: "h4" },
  h5: { type: "block", tag: "h5" },
  h6: { type: "block", tag: "h6" },

  p: { type: "block", tag: "p" },
  span: { type: "inline", tag: "span" },
  strong: { type: "inline", tag: "strong" },
  em: { type: "inline", tag: "em" },
  small: { type: "inline", tag: "small" },

  ul: { type: "block", tag: "ul" },
  ol: { type: "block", tag: "ol" },
  li: { type: "block", tag: "li" },

  img: { type: "self", tag: "img" },
  video: { type: "block", tag: "video" },
  audio: { type: "block", tag: "audio" },

  table: { type: "block", tag: "table" },
  tr: { type: "block", tag: "tr" },
  th: { type: "block", tag: "th" },
  td: { type: "block", tag: "td" },

  form: { type: "block", tag: "form" },
  input: { type: "self", tag: "input" },
  textarea: { type: "block", tag: "textarea" },
  button: { type: "block", tag: "button" },
  label: { type: "block", tag: "label" },

  div: { type: "block", tag: "div" },
  a: { type: "block", tag: "a" },
  iframe: { type: "block", tag: "iframe" },
  br: { type: "self", tag: "br" },
  hr: { type: "self", tag: "hr" },

  /* ZEN-ONLY */
  grid: { type: "zen-grid" },
  card: { type: "zen-card" }
};

/* ============================
   ZENITH V1 — COMPILER (FIXED)
=============================== */
let lastHTML = "";
let lastCSS = "";

function compileZenith() {
  const lines = zenInput.value.split("\n");

  let html = [];
  let css = [];
  let stack = [];

  let classId = 0;
  let lang = "en";
  let pageTitle = "Zenith Page";
  let inHead = false; // track head context

  for (let raw of lines) {
    const line = raw.trim();
    if (!line) continue;

    if (line === "/zen") continue;

    if (line.startsWith("/lang")) {
      lang = line.match(/"(.+?)"/)?.[1] || lang;
      continue;
    }

    if (line === "/charset") continue;

    if (line.startsWith("/page")) {
      pageTitle = line.match(/"(.+?)"/)?.[1] || pageTitle;
      continue;
    }

    // closing tags
    if (line.endsWith("/")) {
      const name = line.slice(1, -1);
      if (name === "head") { inHead = false; continue; }
      const entry = DICTIONARY[name];
      if (entry && entry.type !== "zen-grid" && entry.type !== "zen-card") html.push(`</${entry.tag || "div"}>`);
      continue;
    }

    const parts = line.slice(1).match(/(?:[^\s"]+|"[^"]*")+/g);
    if (!parts) continue;
    const name = parts.shift();
    const entry = DICTIONARY[name];
    if (!entry) continue;

    let text = "";
    let attrs = [];
    let styles = [];

    for (let p of parts) {
      if (p.startsWith("\"")) text = p.slice(1, -1);
      else if (p.includes(":")) {
        const [k, v] = p.split(":");
        if (["font","weight","color","align","size","gap","cols"].includes(k))
          styles.push([k, v]);
        else attrs.push(`${k}="${v}"`);
      }
    }

    // track head
    if (name === "head") { inHead = true; continue; }

    // contextual title handling
    if (name === "title" && !inHead) {
      html.push(`<h1>${text}</h1>`);
      continue;
    }

    let className = "";
    if (styles.length) {
      className = `z-${++classId}`;
      let rules = [];

      for (let [k, v] of styles) {
        if (k === "font") rules.push(`font-family:${v}`);
        if (k === "weight") rules.push(`font-weight:${v}`);
        if (k === "color") rules.push(`color:${v}`);
        if (k === "align") rules.push(`text-align:${v}`);
        if (k === "size") rules.push(`font-size:${v}px`);
        if (k === "gap") rules.push(`gap:${v}px`);
        if (k === "cols") rules.push(`grid-template-columns:repeat(${v},1fr)`);
      }

      css.push(`.${className}{${rules.join(";")}}`);
      attrs.push(`class="${className}"`);
    }

    if (entry.type === "zen-grid") {
      const gridClass = `z-${++classId}`;
      css.push(`.${gridClass}{display:grid}`);
      html.push(`<div class="${gridClass}">`);
      continue;
    }

    if (entry.type === "zen-card") {
      const cardClass = `z-${++classId}`;
      css.push(`.${cardClass}{
        background:#0d1117;
        border:1px solid #30363d;
        border-radius:12px;
        padding:24px;
      }`);
      html.push(`<div class="${cardClass}">`);
      continue;
    }

    html.push(
      entry.type === "self"
        ? `<${entry.tag}${attrs.length ? " " + attrs.join(" ") : ""}>`
        : `<${entry.tag}${attrs.length ? " " + attrs.join(" ") : ""}>${text}`
    );
  }

  lastHTML = `
<!DOCTYPE html>
<html lang="${lang}">
<head>
<meta charset="UTF-8">
<title>${pageTitle}</title>
</head>
<body>
${html.join("\n")}
</body>
</html>
`;

  lastCSS = css.join("\n") || "/* no styles */";

  htmlOut.textContent = lastHTML;
  cssOut.textContent = lastCSS;
}

/* ============================
   PREVIEW
=============================== */
function previewZenith() {
  if (!lastHTML) compileZenith();
  frame.srcdoc = `
<!DOCTYPE html>
<html>
<head><style>${lastCSS}</style></head>
<body>${lastHTML.match(/<body>([\s\S]*)<\/body>/)[1]}</body>
</html>`;
  document.getElementById("preview").style.display = "block";
}

function closePreview() {
  document.getElementById("preview").style.display = "none";
}
</script>

</body>
</html>