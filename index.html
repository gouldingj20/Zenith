<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Zenith Playground</title>

<style>
/* ===== Code-friendly UI ===== */
body {
  background:#0c0c0c;
  color:#00ff99;
  font-family: "Fira Code", monospace;
  padding:24px;
}

h1 {
  color:#ff00ff;
  margin-bottom:12px;
}

textarea, pre {
  width:100%;
  background:#111;
  color:#00ff99;
  border:1px solid #00ff99;
  border-radius:6px;
  padding:12px;
  font-family:"Fira Code", monospace;
  font-size:14px;
  white-space:pre-wrap;
}

textarea {
  height:220px;
  resize:vertical;
}

pre {
  min-height:160px;
}

button {
  background:#ff00ff;
  color:#000;
  border:none;
  padding:10px 18px;
  margin:8px 6px 16px 0;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}

button:hover {
  background:#00ff99;
}

.divider {
  margin:14px 0;
  text-align:center;
  color:#ff00ff;
}

#warnings {
  color:#ff5555;
  margin-top:10px;
}

/* Preview */
#preview {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.95);
  z-index:999;
}

#preview iframe {
  width:90%;
  height:90%;
  margin:3%;
  background:#fff;
  border-radius:8px;
}

#closePreview {
  position:absolute;
  top:14px;
  right:18px;
  background:#ff00ff;
}
</style>
</head>

<body>

<h1>Zenith Playground</h1>

<textarea id="input" placeholder='
/zen
/lang "en"

/head
  /charset
  /page "Zenith Demo"
/head/

/header
  /title "Hello World" serif:bold:#ccc:center
/header/
'></textarea>

<button onclick="compileZenith()">Compile</button>
<button onclick="previewZenith()">Preview</button>

<div class="divider">HTML OUTPUT</div>
<pre id="htmlOut"></pre>

<div class="divider">CSS OUTPUT</div>
<pre id="cssOut"></pre>

<div id="warnings"></div>

<div id="preview">
  <button id="closePreview" onclick="closePreview()">Close</button>
  <iframe id="frame"></iframe>
</div>

<script>
/* ===== ZENITH DICTIONARY (EMBEDDED) ===== */
const DICTIONARY = {
  zen: { type: "doctype" },
  lang: { type: "html-attr", attr: "lang" },

  head: { type: "block", tag: "head" },
  charset: { type: "meta", output: '<meta charset="UTF-8">' },
  page: { type: "meta", tag: "title" },

  header: { type: "block", tag: "header" },
  main: { type: "block", tag: "main" },
  footer: { type: "block", tag: "footer" },

  title: {
    type: "text",
    tag: "h1",
    styles: ["font","weight","color","align"]
  },

  text: {
    type: "text",
    tag: "p",
    styles: ["font","weight","color","align"]
  }
};

/* ===== COMPILER ===== */
function compileZenith() {
  const lines = document.getElementById("input").value.split("\n");
  let htmlBody = [];
  let css = [];
  let warnings = [];

  let lang = "en";
  let title = "Zenith Page";
  let stack = [];

  function open(tag) {
    htmlBody.push("  ".repeat(stack.length) + `<${tag}>`);
    stack.push(tag);
  }

  function close(tag) {
    const last = stack.pop();
    if (last !== tag) warnings.push(`Mismatched close: ${tag}`);
    htmlBody.push("  ".repeat(stack.length) + `</${tag}>`);
  }

  for (let raw of lines) {
    let line = raw.trim();
    if (!line) continue;

    /* DOCTYPE */
    if (line === "/zen") continue;

    /* LANG */
    if (line.startsWith("/lang")) {
      lang = line.match(/"(.+?)"/)?.[1] || lang;
      continue;
    }

    /* BLOCK OPEN */
    if (line.startsWith("/") && !line.endsWith("/")) {
      const name = line.slice(1);
      if (DICTIONARY[name]?.type === "block") {
        open(DICTIONARY[name].tag);
        continue;
      }
    }

    /* BLOCK CLOSE */
    if (line.startsWith("/") && line.endsWith("/")) {
      const name = line.slice(1, -1);
      if (DICTIONARY[name]?.type === "block") {
        close(DICTIONARY[name].tag);
        continue;
      }
    }

    /* META */
    if (line === "/charset") {
      htmlBody.push("  ".repeat(stack.length) + DICTIONARY.charset.output);
      continue;
    }

    if (line.startsWith("/page")) {
      title = line.match(/"(.+?)"/)?.[1] || title;
      continue;
    }

    /* TEXT ELEMENTS */
    if (line.startsWith("/title")) {
      const match = line.match(/"(.+?)"\s*(.*)/);
      const text = match?.[1] || "";
      const style = match?.[2] || "";

      htmlBody.push("  ".repeat(stack.length) + `<h1>${text}</h1>`);

      if (style) {
        const p = style.split(":");
        let rules = [];
        if (p[0]) rules.push(`font-family:${p[0]}`);
        if (p[1]) rules.push(`font-weight:${p[1]}`);
        if (p[2]) rules.push(`color:${p[2]}`);
        if (p[3]) rules.push(`text-align:${p[3] === "centre" ? "center" : p[3]}`);
        css.push(`h1 { ${rules.join("; ")}; }`);
      }
      continue;
    }

    warnings.push("Unknown line: " + line);
  }

  const finalHTML = `<!DOCTYPE html>
<html lang="${lang}">
<head>
  <meta charset="UTF-8">
  <title>${title}</title>
</head>
<body>
${htmlBody.join("\n")}
</body>
</html>`;

  document.getElementById("htmlOut").textContent = finalHTML;
  document.getElementById("cssOut").textContent = css.join("\n");
  document.getElementById("warnings").textContent = warnings.join("\n");
}

/* ===== PREVIEW ===== */
function previewZenith() {
  const html = document.getElementById("htmlOut").textContent;
  const css = document.getElementById("cssOut").textContent;

  const bodyOnly = html
    .replace(/^[\s\S]*?<body>/, "")
    .replace(/<\/body>[\s\S]*$/, "");

  document.getElementById("frame").srcdoc = `
<!DOCTYPE html>
<html>
<head>
<style>${css}</style>
</head>
<body>
${bodyOnly}
</body>
</html>`;

  document.getElementById("preview").style.display = "block";
}

function closePreview() {
  document.getElementById("preview").style.display = "none";
}
</script>

</body>
</html>