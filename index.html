<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Zenith Playground</title>
<style>
body { font-family: sans-serif; padding: 30px; background: #f9f9f9; color: #111; }
h1 { margin-bottom: 20px; }
textarea { width:100%; height:25vh; font-family: monospace; font-size:16px; padding:12px; border-radius:8px; border:1px solid #ccc; margin-bottom:10px; box-sizing:border-box; background:#fff; }
button { padding:10px 20px; border-radius:8px; border:none; background:#333; color:white; cursor:pointer; margin-bottom:20px; }
button:hover { background:#555; }
pre { width:100%; min-height:20vh; background:#f5f5f5; border:1px solid #ccc; border-radius:8px; padding:12px; box-sizing:border-box; overflow:auto; white-space:pre-wrap; font-family: monospace; font-size:16px; margin-bottom:20px; }
#divider { text-align:center; font-weight:bold; margin:10px 0; }
#warnings { color:red; font-family: monospace; margin-top:10px; }
label { font-weight:bold; display:block; margin-top:15px; margin-bottom:5px; }
</style>
</head>
<body>

<h1>Zenith Playground</h1>

<label for="zenithInput">Type your Zenith code:</label>
<textarea id="zenithInput" placeholder='Type here...'></textarea>

<button id="compileBtn">Compile</button>

<label>HTML Output:</label>
<pre id="htmlOutput"></pre>

<div id="divider">----- CSS -----</div>

<label>CSS Output:</label>
<pre id="cssOutput"></pre>

<div id="warnings"></div>

<script>
// --- Dictionary ---
const dictionary = {
  "zenith": {type:"meta"},
  "page": {type:"meta"},
  "header": {tag:"header", type:"section"},
  "hero": {tag:"section", type:"section"},
  "main": {tag:"main", type:"section"},
  "footer": {tag:"footer", type:"section"},
  "stack": {tag:"div", type:"layout", style:"display:flex;flex-direction:column;gap:40px"},
  "grid": {tag:"div", type:"layout", style:"display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:32px"},
  "column": {tag:"div", type:"layout", style:"display:flex;flex-direction:column;gap:16px"},
  "actions": {tag:"div", type:"layout", style:"display:flex;gap:16px;flex-wrap:wrap"},
  "title": {tag:"h1", type:"text"},
  "subtitle": {tag:"h2", type:"text"},
  "text": {tag:"p", type:"text"},
  "step": {tag:"p", type:"text", style:"font-weight:500"},
  "button": {tag:"button", type:"interactive", style:"padding:14px 28px;border-radius:999px;border:none;cursor:pointer"},
  "link": {tag:"a", type:"interactive"},
  "image": {tag:"img", type:"media"},
  "card": {tag:"div", type:"component", style:"padding:32px;border-radius:16px;background:white;box-shadow:0 20px 40px rgba(0,0,0,0.06)"},
  "section": {tag:"section", type:"section"}
};

// --- Compiler ---
function compileZenith(code){
  const lines = code.replace(/\t/g,'  ').split("\n");
  let htmlLang = "en";
  let pageTitle = "Zenith Page";
  let cssLines = [];
  let warnings = [];
  let generatedClasses = new Set();
  let inlineCounter = 0;

  function parse(i=0, parentIndent=0){
    let bodyLines = [];
    while(i<lines.length){
      let line = lines[i];
      if(!line.trim()){ i++; continue; }
      let indent = line.match(/^(\s*)/)[1].length;
      if(indent<parentIndent) break;

      line = line.trim();
      if(line.startsWith("/")){
        const [el,...rest] = line.split(' ');
        const name = el.slice(1);
        let contentRaw = rest.join(" ");
        let def = dictionary[name];

        if(!def){
          warnings.push(`Line ${i+1}: Unknown element '${name}'`);
          bodyLines.push(`<!-- Unknown element: ${name} -->`);
          i++; continue;
        }

        // --- Meta ---
        if(def.type==="meta"){
          if(name==="zenith"){
            const langMatch = rest.find(r=>/^[a-z]{2}$/i.test(r));
            if(langMatch) htmlLang = langMatch.toLowerCase();
            i++; continue;
          }
          if(name==="page"){ pageTitle = contentRaw.replace(/^["“”]|["“”]$/g,''); i++; continue; }
        }

        const tag = def.tag || 'div';
        const classAttr = (def.type==="layout"||def.type==="component")?` class="${name}"`:"";

        // --- Inline style parsing ---
        let content = contentRaw.match(/^"([^"]*)"(.*)$/);
        let textContent = content ? content[1] : contentRaw;
        let styleInfo = content ? content[2].trim() : "";

        let inlineClass = "";
        if(styleInfo){
          inlineCounter++;
          inlineClass = `inline-${inlineCounter}`;
          let cssProps = [];
          let parts = styleInfo.split(":"); // e.g. Serif:bold:#F5f5f5:left
          if(parts[0]) cssProps.push(`font-family:${parts[0]}`);
          if(parts[1]) cssProps.push(`font-weight:${parts[1]}`);
          if(parts[2]) cssProps.push(`color:${parts[2]}`);
          if(parts[3]) cssProps.push(`text-align:${parts[3]}`);
          cssLines.push(`.${inlineClass} { ${cssProps.join("; ")} }`);
        }

        // --- Children ---
        let children = "";
        if(def.type==="layout"||def.type==="section"||def.type==="component"){
          const childResult = parse(i+1, indent+1);
          children = childResult.bodyLines.join('\n');
          i = childResult.next-1;
        }

        if(tag==="img") bodyLines.push(`<img src="${textContent}" alt="" />`);
        else bodyLines.push(`<${tag}${classAttr}${inlineClass?` class="${inlineClass}"`:''}>${textContent}${children?'\n'+children+'\n':''}</${tag}>`);

        if(def.style && !generatedClasses.has(name)){
          if(classAttr) cssLines.push(`.${name} { ${def.style} }`);
          else cssLines.push(`${tag} { ${def.style} }`);
          generatedClasses.add(name);
        }

      } else {
        bodyLines.push(`<p>${line}</p>`);
      }
      i++;
    }
    return {bodyLines, next:i};
  }

  const bodyResult = parse(0);

  let finalHTML = '';
  finalHTML += '<!DOCTYPE html>\n';
  finalHTML += `<html lang="${htmlLang}">\n<head>\n  <meta charset="UTF-8">\n  <title>${pageTitle}</title>\n</head>\n<body>\n`;
  finalHTML += bodyResult.bodyLines.join('\n');
  finalHTML += '\n</body>\n</html>';

  return {html: finalHTML, css: cssLines.join('\n'), warnings};
}

// --- DOM ---
window.addEventListener("DOMContentLoaded",()=>{
  const input = document.getElementById("zenithInput");
  const htmlOut = document.getElementById("htmlOutput");
  const cssOut = document.getElementById("cssOutput");
  const warningsDiv = document.getElementById("warnings");
  const compileBtn = document.getElementById("compileBtn");

  compileBtn.addEventListener("click",()=>{
    const {html, css, warnings} = compileZenith(input.value);
    htmlOut.textContent = html;
    cssOut.textContent = css;
    warningsDiv.textContent = warnings.length ? warnings.join("\n") : "";
  });
});
</script>

</body>
</html>