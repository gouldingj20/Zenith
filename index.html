<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Zenith Playground</title>
<style>
/* Hacky hacker neon vibe */
body {
  font-family: 'Fira Code', monospace;
  background: #0f0f0f;
  color: #00ff99;
  padding: 30px;
}
h1 { color:#ff00ff; margin-bottom:15px; }
textarea {
  width:100%;
  height:25vh;
  font-family:'Fira Code', monospace;
  font-size:16px;
  background:#111;
  color:#00ff99;
  border:1px solid #00ff99;
  border-radius:6px;
  padding:10px;
  resize: vertical;
}
button {
  padding:10px 20px;
  border:none;
  border-radius:6px;
  background:#ff00ff;
  color:#0f0f0f;
  cursor:pointer;
  margin-right:10px;
  margin-bottom:10px;
  font-weight:bold;
}
button:hover { background:#00ff99; color:#111; }
pre {
  width:100%;
  min-height:20vh;
  background:#111;
  border:1px solid #00ff99;
  border-radius:6px;
  padding:10px;
  overflow:auto;
  white-space:pre-wrap;
  font-family:'Fira Code', monospace;
  color:#00ff99;
  margin-bottom:20px;
}
#divider { text-align:center; margin:15px 0; color:#ff00ff; font-weight:bold; }
#warnings { color:#ff5555; font-family:'Fira Code', monospace; margin-top:10px; }

/* Preview Modal */
#previewModal {
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.95);
  z-index:9999;
  align-items:center;
  justify-content:center;
}
#previewContent {
  width:90%; height:90%;
  background:#f8f8f2;
  border-radius:10px;
  overflow:hidden;
  position:relative;
  display:flex;
  flex-direction:column;
}
#previewIframe {
  flex:1; border:none; width:100%; height:100%;
}
#closePreview {
  position:absolute;
  top:10px;
  right:10px;
  background:#ff00ff;
  color:#111;
  border:none;
  border-radius:5px;
  padding:8px 12px;
  cursor:pointer;
  z-index:10;
}
#closePreview:hover { background:#00ff99; color:#111; }
</style>
</head>
<body>

<h1>Zenith Playground</h1>

<label for="zenithInput">Zenith Code:</label>
<textarea id="zenithInput" placeholder='Type here...'></textarea>

<button id="compileBtn">Compile</button>
<button id="previewBtn">Preview</button>

<label>HTML Output:</label>
<pre id="htmlOutput"></pre>

<div id="divider">----- CSS -----</div>

<label>CSS Output:</label>
<pre id="cssOutput"></pre>

<div id="warnings"></div>

<div id="previewModal">
  <div id="previewContent">
    <button id="closePreview">Close</button>
    <iframe id="previewIframe"></iframe>
  </div>
</div>

<script>
const dictionary = {
  "zenith": {type:"meta"},
  "page": {type:"meta"},
  "header": {tag:"header", type:"section"},
  "hero": {tag:"section", type:"section"},
  "main": {tag:"main", type:"section"},
  "footer": {tag:"footer", type:"section"},
  "stack": {tag:"div", type:"layout", style:"display:flex;flex-direction:column;gap:40px"},
  "grid": {tag:"div", type:"layout", style:"display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:32px"},
  "column": {tag:"div", type:"layout", style:"display:flex;flex-direction:column;gap:16px"},
  "actions": {tag:"div", type:"layout", style:"display:flex;gap:16px;flex-wrap:wrap"},
  "title": {tag:"h1", type:"text"},
  "subtitle": {tag:"h2", type:"text"},
  "text": {tag:"p", type:"text"},
  "step": {tag:"p", type:"text", style:"font-weight:500"},
  "button": {tag:"button", type:"interactive", style:"padding:14px 28px;border-radius:999px;border:none;cursor:pointer"},
  "link": {tag:"a", type:"interactive"},
  "image": {tag:"img", type:"media"},
  "card": {tag:"div", type:"component", style:"padding:32px;border-radius:16px;background:white;box-shadow:0 20px 40px rgba(0,0,0,0.06)"},
  "section": {tag:"section", type:"section"}
};

// Compiler now separates HTML & CSS properly
function compileZenith(code){
  const lines = code.split("\n");
  let htmlLang="en", pageTitle="Zenith Page";
  let cssLines=[];
  let warnings=[];

  function parse(i=0,parentIndent=0){
    let bodyLines=[];
    while(i<lines.length){
      let line=lines[i];
      if(!line.trim()){ i++; continue; }
      let indent=line.match(/^(\s*)/)[1].length;
      if(indent<parentIndent) break;
      line=line.trim();
      if(line.startsWith("/")){
        const [el,...rest]=line.split(" ");
        const name=el.slice(1);
        let contentRaw=rest.join(" ");
        let def=dictionary[name];
        if(!def){ warnings.push(`Line ${i+1}: Unknown element '${name}'`); bodyLines.push(`<!-- Unknown element: ${name} -->`); i++; continue; }

        if(def.type==="meta"){
          if(name==="zenith"){ const langMatch=rest.find(r=>/^[a-z]{2}$/i.test(r)); if(langMatch) htmlLang=langMatch.toLowerCase(); i++; continue;}
          if(name==="page"){ pageTitle=contentRaw.replace(/^["“”]|["“”]$/g,''); i++; continue;}
        }

        const tag=def.tag||'div';
        let textContent=contentRaw.replace(/^"|"$/g,'');
        let children="";
        if(def.type==="layout"||def.type==="section"||def.type==="component"){
          const childResult=parse(i+1,indent+1);
          children=childResult.bodyLines.join("\n");
          i=childResult.next-1;
        }
        if(tag==="img") bodyLines.push(`<img src="${textContent}" alt="">`);
        else bodyLines.push(`<${tag}>${textContent}${children?'\n'+children+'\n':''}</${tag}>`);
        // Inline style goes only to CSS
        let styleParts=contentRaw.match(/"[^"]*"\s*(.*)/);
        if(styleParts && styleParts[1].trim()!==""){
          let styleStr=styleParts[1].trim().split(":");
          let cssRules=[];
          if(styleStr[0]) cssRules.push(`font-family:${styleStr[0]}`);
          if(styleStr[1]) cssRules.push(`font-weight:${styleStr[1]}`);
          if(styleStr[2]) cssRules.push(`color:${styleStr[2]}`);
          if(styleStr[3]){ let a=styleStr[3].toLowerCase(); if(a==="centre") a="center"; cssRules.push(`text-align:${a}`);}
          if(cssRules.length>0) cssLines.push(`${tag}:not([class]) { ${cssRules.join("; ")}; }`);
        }
        if(def.style) cssLines.push(`${tag} { ${def.style}; }`);

      } else {
        bodyLines.push(`<p>${line}</p>`);
      }
      i++;
    }
    return {bodyLines,next:i};
  }

  const bodyResult=parse(0);
  const finalHTML=`<!DOCTYPE html>\n<html lang="${htmlLang}">\n<head>\n<meta charset="UTF-8">\n<title>${pageTitle}</title>\n</head>\n<body>\n${bodyResult.bodyLines.join("\n")}\n</body>\n</html>`;
  return {html:finalHTML, css:cssLines.join("\n"), warnings};
}

// DOM
window.addEventListener("DOMContentLoaded",()=>{
  const input=document.getElementById("zenithInput");
  const htmlOut=document.getElementById("htmlOutput");
  const cssOut=document.getElementById("cssOutput");
  const warningsDiv=document.getElementById("warnings");
  const compileBtn=document.getElementById("compileBtn");
  const previewBtn=document.getElementById("previewBtn");
  const previewModal=document.getElementById("previewModal");
  const previewIframe=document.getElementById("previewIframe");
  const closePreview=document.getElementById("closePreview");

  let lastCompiled={html:'', css:''};

  compileBtn.addEventListener("click",()=>{
    const {html, css, warnings}=compileZenith(input.value);
    htmlOut.textContent=html; // clean HTML
    cssOut.textContent=css;   // CSS only
    warningsDiv.textContent=warnings.length?warnings.join("\n"):"";
    lastCompiled={html, css};
  });

  previewBtn.addEventListener("click",()=>{
    if(!lastCompiled.html){ warningsDiv.textContent="Compile first!"; return; }
    const iframeContent=`<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Preview</title>
<style>${lastCompiled.css}</style>
</head>
<body>
${lastCompiled.html.replace(/^<!DOCTYPE html>\n<html[^>]*>\n<head>.*<\/head>\n<body>\n?/s,'').replace(/\n<\/body>\n<\/html>$/,'')}
</body>
</html>`;
    previewIframe.srcdoc=iframeContent;
    previewModal.style.display="flex";
  });

  closePreview.addEventListener("click",()=>{ previewModal.style.display="none"; });
});
</script>

</body>
</html>