<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Zenith Playground</title>

<style>
/* =====================
   UI STYLE (NOT OUTPUT)
===================== */
body {
  background:#0b0f14;
  color:#c9d1d9;
  font-family: "Fira Code", monospace;
  padding:24px;
}

h1 {
  color:#58a6ff;
  margin-bottom:8px;
}

h2 {
  color:#7ee787;
  margin-top:24px;
}

textarea {
  width:100%;
  height:220px;
  background:#010409;
  color:#c9d1d9;
  border:1px solid #30363d;
  border-radius:8px;
  padding:12px;
  font-size:14px;
}

pre {
  background:#010409;
  border:1px solid #30363d;
  border-radius:8px;
  padding:12px;
  min-height:140px;
  white-space:pre-wrap;
}

button {
  background:#238636;
  color:white;
  border:none;
  padding:10px 18px;
  border-radius:999px;
  font-weight:600;
  cursor:pointer;
}

button:hover {
  background:#2ea043;
}

.controls {
  margin:12px 0;
  display:flex;
  gap:12px;
}

#preview {
  display:none;
  position:fixed;
  inset:0;
  background:#000c;
  z-index:999;
}

#preview iframe {
  width:90%;
  height:90%;
  margin:3% auto;
  display:block;
  background:white;
  border-radius:12px;
}

#preview button {
  position:absolute;
  top:16px;
  right:16px;
  background:#f85149;
}
</style>
</head>

<body>

<h1>Zenith Simple Code</h1>

<textarea id="zenInput">
/zen
/lang "en"

/head
/charset
/page "Zenith Demo"
/head/

/header
/title "Hello World" serif:bold:#ccc:center
/header/
</textarea>

<div class="controls">
  <button onclick="compileZenith()">Compile</button>
  <button onclick="previewZenith()">Preview</button>
</div>

<h2>HTML Output</h2>
<pre id="htmlOut"></pre>

<h2>CSS Output</h2>
<pre id="cssOut"></pre>

<div id="preview">
  <button onclick="closePreview()">Close</button>
  <iframe id="frame"></iframe>
</div>

<script>
/* ============================
   ZENITH V1 — GRAMMAR
===============================
- Lines start with /
- /tag opens
- /tag/ closes
- Text must be in "quotes"
- Attributes use key:value
- Complex values use key:"value"
- Boolean attributes allowed
- Styles are shortcuts:
  font weight color align size
- CSS NEVER appears in HTML
=============================== */


/* ============================
   ZENITH V1 — DICTIONARY
=============================== */

const DICTIONARY = {
  // document
  zen: { type: "doctype" },
  html: { type: "block", tag: "html" },
  head: { type: "block", tag: "head" },
  body: { type: "block", tag: "body" },
  title: { type: "block", tag: "title" },
  meta: { type: "self", tag: "meta" },
  link: { type: "self", tag: "link" },
  script: { type: "block", tag: "script" },
  style: { type: "block", tag: "style" },

  // sectioning
  header: { type: "block", tag: "header" },
  nav: { type: "block", tag: "nav" },
  main: { type: "block", tag: "main" },
  section: { type: "block", tag: "section" },
  article: { type: "block", tag: "article" },
  aside: { type: "block", tag: "aside" },
  footer: { type: "block", tag: "footer" },

  // text
  h1: { type: "block", tag: "h1" },
  h2: { type: "block", tag: "h2" },
  h3: { type: "block", tag: "h3" },
  h4: { type: "block", tag: "h4" },
  h5: { type: "block", tag: "h5" },
  h6: { type: "block", tag: "h6" },
  p: { type: "block", tag: "p" },
  span: { type: "inline", tag: "span" },
  strong: { type: "inline", tag: "strong" },
  em: { type: "inline", tag: "em" },
  small: { type: "inline", tag: "small" },

  // lists
  ul: { type: "block", tag: "ul" },
  ol: { type: "block", tag: "ol" },
  li: { type: "block", tag: "li" },

  // media
  img: { type: "self", tag: "img" },
  video: { type: "block", tag: "video" },
  audio: { type: "block", tag: "audio" },
  source: { type: "self", tag: "source" },

  // tables
  table: { type: "block", tag: "table" },
  thead: { type: "block", tag: "thead" },
  tbody: { type: "block", tag: "tbody" },
  tr: { type: "block", tag: "tr" },
  th: { type: "block", tag: "th" },
  td: { type: "block", tag: "td" },

  // forms
  form: { type: "block", tag: "form" },
  input: { type: "self", tag: "input" },
  textarea: { type: "block", tag: "textarea" },
  button: { type: "block", tag: "button" },
  label: { type: "block", tag: "label" },
  select: { type: "block", tag: "select" },
  option: { type: "block", tag: "option" },

  // misc
  div: { type: "block", tag: "div" },
  a: { type: "block", tag: "a" },
  iframe: { type: "block", tag: "iframe" },
  br: { type: "self", tag: "br" },
  hr: { type: "self", tag: "hr" }
};


/* ============================
   ZENITH V1 — COMPILER
=============================== */

let lastHTML = "";
let lastCSS = "";

function compileZenith() {
  const input = zenInput.value.split("\n");

  let html = [];
  let css = [];
  let stack = [];
  let classId = 0;

  for (let raw of input) {
    const line = raw.trim();
    if (!line) continue;

    // DOCTYPE
    if (line === "/zen") {
      html.push("<!DOCTYPE html>");
      continue;
    }

    // CLOSE BLOCK
    if (line.endsWith("/")) {
      const name = line.slice(1, -1);
      const entry = DICTIONARY[name];
      if (entry) {
        html.push(`</${entry.tag}>`);
        stack.pop();
      }
      continue;
    }

    if (!line.startsWith("/")) continue;

    const parts = line.slice(1).match(/(?:[^\s"]+|"[^"]*")+/g);
    const name = parts.shift();
    const entry = DICTIONARY[name];
    if (!entry) continue;

    let text = "";
    let attrs = [];
    let styles = [];

    for (let p of parts) {
      if (p.startsWith("\"")) {
        text = p.slice(1, -1);
      } else if (p.includes(":")) {
        const [k, vRaw] = p.split(":");
        const v = vRaw.replace(/"/g, "");
        if (["color", "align", "size", "weight", "font"].includes(k)) {
          styles.push([k, v]);
        } else {
          attrs.push(`${k}="${v}"`);
        }
      } else {
        attrs.push(p);
      }
    }

    let className = "";
    if (styles.length) {
      className = `z-${++classId}`;
      let rules = [];
      for (let [k, v] of styles) {
        if (k === "align") rules.push(`text-align:${v}`);
        if (k === "color") rules.push(`color:${v}`);
        if (k === "size") rules.push(`font-size:${v}px`);
        if (k === "weight") rules.push(`font-weight:${v}`);
        if (k === "font") rules.push(`font-family:${v}`);
      }
      css.push(`.${className} { ${rules.join("; ")} }`);
    }

    if (className) attrs.push(`class="${className}"`);

    if (entry.type === "self") {
      html.push(`<${entry.tag}${attrs.length ? " " + attrs.join(" ") : ""}>`);
    } else {
      html.push(`<${entry.tag}${attrs.length ? " " + attrs.join(" ") : ""}>${text}`);
      stack.push(entry.tag);
    }
  }

  while (stack.length) {
    html.push(`</${stack.pop()}>`);
  }

  lastHTML = html.join("\n");
  lastCSS = css.join("\n") || "/* no styles */";

  htmlOut.textContent = lastHTML;
  cssOut.textContent = lastCSS;
}


/* ============================
   ZENITH V1 — PREVIEW
=============================== */

function previewZenith() {
  if (!lastHTML) compileZenith();

  const bodyMatch = lastHTML.match(/<body[^>]*>([\s\S]*)<\/body>/);
  const body = bodyMatch ? bodyMatch[1] : lastHTML;

  preview.srcdoc = `
<!DOCTYPE html>
<html>
<head>
<style>
${lastCSS}
</style>
</head>
<body>
${body}
</body>
</html>
`;
}
</script>

</body>
</html>